---
title: "volleyball.rmd"
output: html_document
date: "2022-09-28"
---

```{r}
library(tidyverse)
```

#The two additional factors I wanted to see from the quiz were blocks and game score. To reiterate, blocks are an essential part of the game, and within the data we were provided, there are several components of blocks — solo blocks, block assists and block errors. We already have kills and aces (two offensive metrics) and digs (a defensive stat), so I felt like adding a second defensive metric in blocks would help show which teams were the strongest. I also wanted to leave in kills, aces and digs because each of those metrics is intergral to the sport. We also have the game score data in team_score and opponent_score. I wanted to include this information because it is the easiest way for us to measure dominance with the data we were given. For example, a team that wins a majority of its games 3-0 is a stronger unit than a team that wins 3-2. Granted, strength of opponent is a factor in this, but seeing as we don't have that data, team and opponent score seem like good ways to see which teams were the most dominant.

```{r setup, include=FALSE}
match_data <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensVolleyballData/main/data/ncaa_womens_volleyball_matchstats_2022.csv")

head(match_data)

teamquality <- match_data %>% 
  select(team, kills, digs, aces, block_solos, block_assists, b_err, team_score, opponent_score)

teamtotals <- teamquality %>% 
  group_by(team) %>% 
  summarise(
    KillsAvg = mean(kills), 
    DigsAvg = mean(digs), 
    AcesAvg = mean(aces),
    BSoloAvg = mean(block_solos),
    BAssAvg = mean(block_assists),
    BErrAvg = mean(b_err),
    TeamScoreAvg = mean(team_score),
    OppScoreAvg = mean(opponent_score),
    ) 

teamzscore <- teamtotals %>% 
  mutate(
    killszscore = as.numeric(scale(KillsAvg, center = TRUE, scale = TRUE)),
    digszscore = as.numeric(scale(DigsAvg, center = TRUE, scale = TRUE)),
    aceszscore = as.numeric(scale(AcesAvg, center = TRUE, scale = TRUE)),
    soloblockszscore = as.numeric(scale(BSoloAvg, center = TRUE, scale = TRUE)),
    blockassistzscore = as.numeric(scale(BAssAvg, center = TRUE, scale = TRUE)),
    blockerrorzscore = as.numeric(scale(BErrAvg, center = TRUE, scale = TRUE)),
    teamscorezscore = as.numeric(scale(TeamScoreAvg, center = TRUE, scale = TRUE)),
    oppscorezscore = as.numeric(scale(OppScoreAvg, center = TRUE, scale = TRUE)) * -1,
    TotalZscore = killszscore + digszscore + aceszscore + soloblockszscore + blockassistzscore + blockerrorzscore + teamscorezscore + oppscorezscore
    ) %>% ungroup() 

head(teamzscore)

teamzscore %>% arrange(desc(TotalZscore))

big_ten <- c("Nebraska Cornhuskers", "Minnesota Golden Gophers", "Iowa Hawkeyes", "Wisconsin Badgers", "Illinois Fighting Illini", "Northwestern Wildcats", "Purdue Boilermakers", "Indiana Hoosiers", "Michigan Wolverines", "Michigan St. Spartans", "Ohio St. Buckeyes", "Penn St. Nittany Lions", "Maryland Terrapins, Terps", "Rutgers Scarlet Knights")

teamzscore %>% 
  filter(team %in% big_ten) %>% 
  arrange(desc(TotalZscore)) %>%
  select(team, TotalZscore)

teamzscore %>% 
  filter(team == "Maryland Terrapins, Terps") %>% 
  arrange(desc(TotalZscore)) %>%
  select(team, TotalZscore)
```
#Who are the highest-performing teams in the NCAA (based on my new-and-improved TotalZScores)? 

Here are the top 10 highest-performing teams in the NCAA with their z-scores:
1. UTEP Miners (8.4)
2. Idaho St. Bengals (7.6)
3. Northwestern St. Lady Demons (7.2)
4. New Mexico Lobos (7.1)
5. Saint Louis Billikens (7.0)
6. UNLV Lady Rebels (6.7)
7. Wright St. Raiders (6.5)
8. Oregon Ducks (5.963)
9. UT Arlington Mavericks (5.961)
10. South Dakota Coyotes (5.7)

And here is the AVCA Coaches ranking of the top 10 teams with their zscores:
1. Texas (-2.2)
2. Louisville (0.8)
3. Nebraska (-2.5)
4. Univ. of SD (1.0)
5. Purdue (2.5)
6. OSU (-4.3)
7. Minnesota (0.1)
8. Wisconsin (0.1)
9. Stanford (-1.0)
10. Pitt (0.9)

#Clearly, despite my best intentions, the highest-performing teams in the NCAA based on my z-scores aren't the actual best ten teams in the country according to the rankings. Rankings are subjective, but the 10 teams listed in the AVCA are some of the best in the nation. WHY IS THIS...? I have a couple thoughts. 

#First, let's just take the top teams in each list — UTEP and Texas — and compare the seasons they are having just to see why we got the teams we did in the first list. 

```{r}
teamzscore %>% 
  filter(team == "UTEP Miners")

#Here are UTEP's numbers in averages:
#Kills: 52.6
#Digs: 59
#Aces: 8.2
#BlockSolo: 2.5
#BlockAssist: 16
#BlockError: 1.5
#TeamScore: 2.2
#OpponentScore: 2.1 
  
teamzscore %>% 
  filter(team == "Texas Longhorns") 

#Here are Texas's numbers in averages:
#Kills: 49.6
#Digs: 46.6
#Aces: 5.8
#BlockSolo: 0.7
#BlockAssist: 12.2
#BlockError: 1.1
#TeamScore: 3
#OpponentScore: 0.5
```

Woah, UTEP looks pretty darn competitive here! But wait, let's glance at the final two categories. UTEP is 8-7. Only one of their wins has been by a score of 3-0. Texas meanwhile is a perfect 10-0, with six wins coming at 3-0. Texas has also defeated multiple team that are nationally ranked so far. In looking at team and opponent score, Texas is a far better team than UTEP — the Longhorns win their matches by an average score of 3-0.5, while the Miners win by an average score of 2.2-2.1. UTEP is nowhere near as dominant in terms of its game score as Texas. This tells me that there is something to using game scores to evaluate how good a team is. We could also ask how much we dilute a team's talent by adding in all these additional statistics.

Which leads us to...

Another issue with these z-scores is that we're assuming that each one of these metrics is equally related to victories. Is it possible that aces are more important than blocks? Or are kills more valuable than block assists? Maybe adding in all the nitty gritty parts of blocks messes up our 

Another important element to consider is that there is no way to adjust for strength of schedule within our data. Based on a total z-score, UTEP might come out ahead of Texas, even though a game between the two teams would most likely end in a straightforward Texas victory. And just using game score might not be that effective because a team like Texas might defeat a stronger opponent 3-2, like it did against Kansas, but be penalized for a result over another team that might have defeated a weaker opponent 3-0 (even though this isn't the case for Texas vs. UTEP). 

#Where does Maryland rank on the Z-score scale and what teams are similar to it? 
Maryland's z-score is 2.7, which makes it the 79th best team in the country according to these metrics. By these metrics, Maryland is a better overall team than all of the teams that appear in the AVCA list...When we look at the Big Ten standings this season, Maryland is 0-2 with losses to Illinois and Indiana. Last season, the Terps were 7-13 in conference play and finished ninth. 

The nine teams that are most similar to Maryland using these metrics are the Grand Canyon Lopes, Drake Bulldogs, Southern Miss. Golden Eagles, Kent St. Golden Flashes, Georgia St. Panthers, St. John's (NY) Red Storm, Bellarmine Knights, Chicago St. Cougars, Miami (FL) Hurricanes.

#This was my first attempt at this assignemnt. Here, I tried to follow the steps from the tutorial. I got to the very end but realized I was working with match data as opposed to using data that had been compressed for each team, so I started semi-anew (seen above). Still, I thought I would leave it here to show my first try.
```{r}
perset_stats <- match_data %>% 
  mutate(
    killsperset = kills/s,
    digsperset = digs/s,
    acesperset = aces/s,
    soloblocksperset = block_solos/s,
    blockassistsperset = block_assists/s,
    blockerrorsperset = b_err/s,
    teamscoreperset = team_score/s,
    oppscoreperset = opponent_score/s
    ) %>%
  select(date, team, killsperset, digsperset, acesperset, soloblocksperset, blockassistsperset, blockerrorsperset, teamscoreperset, oppscoreperset)

head(perset_stats)

teamzscore <- perset_stats %>%
  group_by(team) %>% 
  mutate(
    killszscore = as.numeric(scale(killsperset, center = TRUE, scale = TRUE)),
    digszscore = as.numeric(scale(digsperset, center = TRUE, scale = TRUE)),
    aceszscore = as.numeric(scale(acesperset, center = TRUE, scale = TRUE)),
    soloblockszscore = as.numeric(scale(soloblocksperset, center = TRUE, scale = TRUE)),
    blockassistzscore = as.numeric(scale(blockassistsperset, center = TRUE, scale = TRUE)),
    blockerrorzscore = as.numeric(scale(blockerrorsperset, center = TRUE, scale = TRUE)),
    teamscorezscore = as.numeric(scale(teamscoreperset, center = TRUE, scale = TRUE)),
    oppscorezscore = as.numeric(scale(oppscoreperset, center = TRUE, scale = TRUE)),
    TotalZscore = killszscore + aceszscore + digszscore + soloblockszscore + blockassistzscore + blockerrorzscore + teamscorezscore + oppscorezscore
    ) %>% ungroup() 

head(teamzscore)

teamzscore %>% arrange(desc(TotalZscore))

teamzscore %>% 
  filter(team == "Maryland Terrapins, Terps") %>% 
  arrange(desc(TotalZscore)) %>%
  select(date, team, TotalZscore)
```