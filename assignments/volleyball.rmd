---
title: "volleyball.rmd"
output: html_document
date: "2022-09-28"
---

```{r}
library(tidyverse)
```

#The two additional factors I wanted to see from the quiz were blocks and game score. To reiterate, blocks are an essential part of the game, and within the data we were provided, there are several components of blocks — solo blocks, block assists and block errors. We already have kills and aces (two offensive metrics) and digs (a defensive stat), so I felt like adding a second defensive metric in blocks would help show which teams were the strongest. I also wanted to leave in kills, aces and digs because each of those metrics is intergral to the sport. We also have the game score data in team_score and opponent_score. I wanted to include this information because it is the easiest way for us to measure dominance with the data we were given. For example, a team that wins a majority of its games 3-0 is a stronger unit than a team that wins 3-2. Granted, strength of opponent is a factor in this, but seeing as we don't have that data, team and opponent score seem like good ways to see which teams were the most dominant.

```{r setup, include=FALSE}
match_data <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensVolleyballData/main/data/ncaa_womens_volleyball_matchstats_2022.csv")

head(match_data)

teamquality <- match_data %>% 
  select(team, kills, digs, aces, block_solos, block_assists, b_err, team_score, opponent_score)

teamtotals <- teamquality %>% 
  group_by(team) %>% 
  summarise(
    KillsAvg = mean(kills), 
    DigsAvg = mean(digs), 
    AcesAvg = mean(aces),
    BSoloAvg = mean(block_solos),
    BAssAvg = mean(block_assists),
    BErrAvg = mean(b_err),
    TeamScoreAvg = mean(team_score),
    OppScoreAvg = mean(opponent_score),
    ) 

teamzscore <- teamtotals %>% 
  mutate(
    killszscore = as.numeric(scale(KillsAvg, center = TRUE, scale = TRUE)),
    digszscore = as.numeric(scale(DigsAvg, center = TRUE, scale = TRUE)),
    aceszscore = as.numeric(scale(AcesAvg, center = TRUE, scale = TRUE)),
    soloblockszscore = as.numeric(scale(BSoloAvg, center = TRUE, scale = TRUE)),
    blockassistzscore = as.numeric(scale(BAssAvg, center = TRUE, scale = TRUE)),
    blockerrorzscore = as.numeric(scale(BErrAvg, center = TRUE, scale = TRUE)),
    teamscorezscore = as.numeric(scale(TeamScoreAvg, center = TRUE, scale = TRUE)),
    oppscorezscore = as.numeric(scale(OppScoreAvg, center = TRUE, scale = TRUE)),
    TotalZscore = KillsAvg + DigsAvg + AcesAvg + BSoloAvg + BAssAvg + BErrAvg + TeamScoreAvg + OppScoreAvg
    ) %>% ungroup() 

head(teamzscore)

teamzscore %>% arrange(desc(TotalZscore))

teamzscore %>% 
  filter(team == "Maryland Terrapins, Terps") %>% 
  arrange(desc(TotalZscore)) %>%
  select(team, TotalZscore)
```
#Who are the highest-performing teams in the NCAA (based on my new-and-improved TotalZScores)? 

Here are the top 10 highest-performing teams in the NCAA witht their z-scores:
1. Wright St. Raiders (154.8)
2. New Mexico Lobos (149.1)
3. Creighton Bluejays (148.5)
4. Ball St. Cardinals (146.6)
5. Chattanooga Mocs (145.2)
6. Tulsa Golden Hurricane (145.1)
7. UTEP Miners (144.2)
8. Murray St. Racers (144.0)
9. Valparaiso Beacons (143.5)
10. McNeese Cowgirls (142.9)

And here is the AVCA Coaches ranking of the top 10 teams with their zscores:
1. Texas (119.5)
2. Louisville (116.75)
3. Nebraska (125.2727)
4. Univ. of SD (126.3)
5. Purdue (126.3)
6. OSU (113.8)
7. Minnesota (121.3)
8. Wisconsin (117.9)
9. Stanford (121.9)
10. Pitt (122.8)

#Clearly, despite my best intentions, the highest-performing teams in the NCAA based on my z-scores aren't the actual best ten teams in the country according to the rankings. Rankings are subjective, but the 10 teams listed in the AVCA are some of the best in the nation. WHY IS THIS...? I have a couple thoughts. 

#First, let's just take the top teams in each list — Wright State and Texas — and compare the seasons they are having just to see why we got the teams we did in the first list. 

```{r}
teamzscore %>% 
  filter(team == "Wright St. Raiders")

#Here are Wright State's numbers:
#Kills: 54
#Digs: 71.5
#Aces: 6.2
#BlockSolo: 1.8
#BlockAssist: 16
#BlockError: 1.2
#TeamScore: 2.7
#OpponentScore: 1.5
  
teamzscore %>% 
  filter(team == "Texas Longhorns") 

#Here are Texas's numbers:
#Kills: 49.6
#Digs: 46.6
#Aces: 5.8
#BlockSolo: 0.7
#BlockAssist: 12.2
#BlockError: 1.1
#TeamScore: 3
#OpponentScore: 0.5
```

Wright State is 11-3. Two of their wins have been 3-0 wallopings, seven have come at a 3-1 margin and two have been 3-2. Of their three losses, two have been 2-3 and one has been 1-3. Texas meanwhile is a perfect 10-0, with six wins coming at 3-0, three at 3-1 and just one at 3-2. Texas has also defeated multiple team that are nationally ranked so far.  

There is no way to adjust for strength of schedule within our data. Based on a total z-score, Wright State might come out ahead of Texas, even though if the two teams played the outcome would be a pretty straightforward Texas victory. And just using game score might not be that effective because a team like Texas might defeat a stronger opponent 3-2, like it did against Kansas, but be penalized for a result over another team that might have defeated a weaker opponent 3-0. 

Another issue with these z-scores is that we're assuming that each one of these metrics is equally related to victories. Is it possible that aces are more important than blocks? Or are kills more valuable than block assists? 

#Where does Maryland rank on the Z-score scale and what teams are similar to it? 
Maryland's z-score is 123.7, which makes it the 158th best team in the country according to these metrics. By these metrics, Maryland is a better overall team than all but three of the teams that appear in the AVCA list...When we look at the Big Ten standings this season, Maryland is 0-2 with losses to Illinois and Indiana. Last season, the Terps were 7-13 in conference play and finished ninth. 

The nine teams that are most simialr to Maryland using these metrics are the Charlotte 49ers, Lehigh Mountain Hawks, Charleston So. Buccaneers, Portland Pilots, Sacred Heart Pioneers, Davidson Wildcats, Memphis Tigers, Hawaii Rainbow Wahine, Southeastern La. Lady Lions.

#This was my first attempt at this assignemnt. Here, I tried to follow the steps from the tutorial. I got to the very end but realized I was working with match data as opposed to using data that had been compressed for each team, so I started semi-anew (seen above). Still, I thought I would leave it here to show my first try.
```{r}
perset_stats <- match_data %>% 
  mutate(
    killsperset = kills/s,
    digsperset = digs/s,
    acesperset = aces/s,
    soloblocksperset = block_solos/s,
    blockassistsperset = block_assists/s,
    blockerrorsperset = b_err/s,
    teamscoreperset = team_score/s,
    oppscoreperset = opponent_score/s
    ) %>%
  select(date, team, killsperset, digsperset, acesperset, soloblocksperset, blockassistsperset, blockerrorsperset, teamscoreperset, oppscoreperset)

head(perset_stats)

teamzscore <- perset_stats %>%
  group_by(team) %>% 
  mutate(
    killszscore = as.numeric(scale(killsperset, center = TRUE, scale = TRUE)),
    digszscore = as.numeric(scale(digsperset, center = TRUE, scale = TRUE)),
    aceszscore = as.numeric(scale(acesperset, center = TRUE, scale = TRUE)),
    soloblockszscore = as.numeric(scale(soloblocksperset, center = TRUE, scale = TRUE)),
    blockassistzscore = as.numeric(scale(blockassistsperset, center = TRUE, scale = TRUE)),
    blockerrorzscore = as.numeric(scale(blockerrorsperset, center = TRUE, scale = TRUE)),
    teamscorezscore = as.numeric(scale(teamscoreperset, center = TRUE, scale = TRUE)),
    oppscorezscore = as.numeric(scale(oppscoreperset, center = TRUE, scale = TRUE)),
    TotalZscore = killszscore + aceszscore + digszscore + soloblockszscore + blockassistzscore + blockerrorzscore + teamscorezscore + oppscorezscore
    ) %>% ungroup() 

head(teamzscore)

teamzscore %>% arrange(desc(TotalZscore))

teamzscore %>% 
  filter(team == "Maryland Terrapins, Terps") %>% 
  arrange(desc(TotalZscore)) %>%
  select(date, team, TotalZscore)
```